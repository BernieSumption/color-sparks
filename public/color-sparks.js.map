{"version":3,"sources":["node_modules/auto-reload-brunch/vendor/auto-reload.js","app/color-sparks.coffee","app/requestAnimationFrame.coffee"],"names":[],"mappings":"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","file":"public/color-sparks.js","sourcesContent":["(function() {\n  var WebSocket = window.WebSocket || window.MozWebSocket;\n  var br = window.brunch = (window.brunch || {});\n  var ar = br['auto-reload'] = (br['auto-reload'] || {});\n  if (!WebSocket || ar.disabled) return;\n\n  var cacheBuster = function(url){\n    var date = Math.round(Date.now() / 1000).toString();\n    url = url.replace(/(\\&|\\\\?)cacheBuster=\\d*/, '');\n    return url + (url.indexOf('?') >= 0 ? '&' : '?') +'cacheBuster=' + date;\n  };\n\n  var reloaders = {\n    page: function(){\n      window.location.reload(true);\n    },\n\n    stylesheet: function(){\n      [].slice\n        .call(document.querySelectorAll('link[rel=\"stylesheet\"]'))\n        .filter(function(link){\n          return (link != null && link.href != null);\n        })\n        .forEach(function(link) {\n          link.href = cacheBuster(link.href);\n        });\n\n      // hack to force page repaint\n      var el = document.body;\n      var bodyDisplay = el.style.display || 'block';\n      el.style.display = 'none';\n      el.offsetHeight;\n      el.style.display = bodyDisplay;\n    }\n  };\n  var port = ar.port || 9485;\n  var host = br.server || window.location.hostname;\n\n  var connect = function(){\n    var connection = new WebSocket('ws://' + host + ':' + port);\n    connection.onmessage = function(event){\n      if (ar.disabled) return;\n      var message = event.data;\n      var reloader = reloaders[message] || reloaders.page;\n      reloader();\n    };\n    connection.onerror = function(){\n      if (connection.readyState) connection.close();\n    };\n    connection.onclose = function(){\n      window.setTimeout(connect, 1000);\n    };\n  };\n  connect();\n})();\n","\n\n\n# Represents a property that can take any value in a range\nclass Range\n  constructor: (@from, @to) ->\n  get: ->\n    random @from, @to\n\n# Configuration constants\n\n\nRADIUS_DECAY = new Range(0.95, 0.99)\nMAX_INITIAL_V = 1\nINITIAL_DIAMETER = new Range(5, 20)\nFORCE_AMPLITUDE = new Range(-0.2, 0.2)\nFORCE_PERIOD = new Range(10, 50)\nGREY_VALUE = new Range(0, 128)\nTRANSPARENCY = 0.1\nSPARK_FRAMES_PER_SECOND = 10\nBG_RELEASE_PROBABILITY = 0.3\nDARKENING_DIAMETER = new Range(3, 7)\nDARKENING_BEGIN_DELAY = 5\nDARKENING_ALPHA = 0.1\nBACKGROUND_COLOR = \"#000000\"\n\n\nINITIAL_SPARKS_PER_SECOND = 1000\nMAX_SPARKS_PER_SECOND = 2000\nMIN_SPARKS_PER_SECOND = 100\nTARGET_FPS = 50\nSPARKS_PER_SECOND_ADJUST_RATE = 0.001\n\n\n# A canvas onto which dots are drawn\nclass ColorSparks\n  constructor: (@canvas, velocityMapUrl, @logPerformance = false) ->\n    @ctx = canvas.getContext \"2d\"\n    @reset()\n\n    @frameCount = 0\n    @framesPerSecond = 60\n    @sparksPerSecond = INITIAL_SPARKS_PER_SECOND\n\n    window.requestAnimationFrame @draw\n\n    @canvas.addEventListener \"mousedown\", @updateSparkPosition\n    @canvas.addEventListener \"mousemove\", @updateSparkPosition\n    @canvas.addEventListener \"touchstart\", @updateSparkPosition\n    @canvas.addEventListener \"touchmove\", @updateSparkPosition\n\n  # wipe the canvas and reset the animation state\n  reset: ->\n    @canvas.height = @height = @canvas.offsetHeight\n    @canvas.width = @width = @canvas.offsetWidth\n    @ctx.beginPath()\n    @ctx.rect 0, 0, @canvas.width, @canvas.height\n    @ctx.closePath()\n    @ctx.fillStyle = BACKGROUND_COLOR\n    @ctx.fill()\n    @releaseX = @width/2\n    @releaseY = @height/2\n    @sparks = []\n    return\n\n  # main rendering function executed every frame\n  draw: (timestamp) =>\n    unless @height == @canvas.offsetHeight and @width == @canvas.offsetWidth\n      @reset()\n\n    # calculate frames per second, averaging over 10 frames for consistency\n    @frameCount += 1\n    if @frameCount % 10 == 1\n      @framesPerSecond = Math.round(10 / (timestamp - @prevTimestamp) * 1000) || 60 # assume 60 fps on first frame\n      @prevTimestamp = timestamp\n\n    # adjust spark release rate up or down to hit target fps\n    if @framesPerSecond < TARGET_FPS and @sparksPerSecond < MAX_SPARKS_PER_SECOND\n      @sparksPerSecond -= (@sparksPerSecond * SPARKS_PER_SECOND_ADJUST_RATE)\n    else if @framesPerSecond > TARGET_FPS and @sparksPerSecond > MIN_SPARKS_PER_SECOND\n      @sparksPerSecond += (@sparksPerSecond * SPARKS_PER_SECOND_ADJUST_RATE)\n\n    if @logPerformance and @frameCount % 100 == 0\n        console.log \"fps=#{@framesPerSecond}, sparks=#{@sparks.length}, releaseRate=#{@sparksPerSecond.toFixed(2)}\"\n\n    sparksToRelease = @sparksPerSecond / @framesPerSecond\n    for i in [0..sparksToRelease] by 1\n      spark = new Spark(\n        new Point(@releaseX, @releaseY),\n        new Point(Math.random()*2-1, Math.random()*2-1),\n        randomColor())\n      @sparks.push(spark)\n    @timestampLastFrame = timestamp\n\n    i = 0\n    finishedUpTo = -1\n    while i < @sparks.length\n      if @sparks[i].active\n        @sparks[i].update(@ctx)\n      else if finishedUpTo == i - 1\n          finishedUpTo = i\n      i++\n    if finishedUpTo > -1\n      @sparks.splice 0, finishedUpTo + 1\n\n    window.requestAnimationFrame @draw\n    return\n\n\n  updateSparkPosition: (event) =>\n    @releaseX = event.offsetX || event.layerX\n    @releaseY = event.offsetY || event.layerY\n\n\n  calculateReleaseRate: ->\n    milliseconds = 10\n    sparksPerIteration = 100\n    start = getTimer()\n    totalSparks = 0\n    while getTimer() - start < milliseconds\n      for i in [0..sparksPerIteration] by 1\n        spark = new Spark(\n          new Point(50, 50),\n          new Point(Math.random()*2-1, Math.random()*2-1),\n          randomColor())\n        spark.update(@ctx)\n        totalSparks += sparksPerIteration\n    @reset()\n    idealReleaseRate = totalSparks / milliseconds / 60 / 2\n    console.log \"ideal release rate = #{idealReleaseRate}\"\n    return idealReleaseRate\n\n\n\n\n\n# A single dot on a ColorSparks canvas\nclass Spark\n\n  # Create a point with location and velocity Points\n  # and a color style\n  constructor: (@location, @velocity, @color) ->\n    @initialLocation = @location.clone()\n    @forceCounter = 0\n    @active = true\n\n    @radius = INITIAL_DIAMETER.get() / 2\n    @radiusDecay = RADIUS_DECAY.get()\n    @darkeningRadius = DARKENING_DIAMETER.get() / 2\n    @xForceAmplitude = FORCE_AMPLITUDE.get()\n    @xForcePeriod = FORCE_PERIOD.get()\n    @yForceAmplitude = FORCE_AMPLITUDE.get()\n    @yForcePeriod = FORCE_PERIOD.get()\n\n  update: (ctx) ->\n    ctx.beginPath()\n    ctx.arc @location.x, @location.y, @radius, 0, Math.PI * 2, false\n    ctx.closePath()\n    ctx.fillStyle = @color\n    ctx.fill()\n    @forceCounter++\n    @velocity.x += Math.sin(Math.PI * 2 * @forceCounter / @xForcePeriod) * @xForceAmplitude\n    @velocity.y += Math.sin(Math.PI * 2 * @forceCounter / @yForcePeriod) * @yForceAmplitude\n    if @isText\n      ctx.beginPath()\n      ctx.arc @initialLocation.x + random(-1, 1), @initialLocation.y + random(-1, 1), @darkeningRadius, 0, Math.PI * 2, false\n      ctx.closePath()\n      ctx.fillStyle = \"rgba(0, 0, 0, \" + DARKENING_ALPHA + \")\"\n      ctx.fill()\n    if @radius < 1\n      @active = false\n    @location.x += @velocity.x\n    @location.y += @velocity.y\n    @radius *= @radiusDecay\n    return\n\n\n# A class for reading pixel data from an image\nclass VelocityMap\n  constructor: (src) ->\n    @image = new Image()\n    @image.onload = @handleImageLoad\n    @loaded = false\n\n  handleImageLoad: =>\n    imgCanvas = document.createElement(\"canvas\")\n    imgCanvas.width = imgWidth = @image.width\n    imgCanvas.height = imgHeight = @image.height\n    imgCtx = imgCanvas.getContext(\"2d\")\n    imgCtx.drawImage image, 0, 0\n    @imageData = imgCtx.getImageData(x, y, imgCanvas.width, imgCanvas.height)\n    @width = imgCanvas.width\n\n  velocityAt: (x, y) ->\n    offset = y * @width + x\n    return new Point(\n      (@imageData[offset] / 128 - 1) * MAX_INITIAL_V\n      (@imageData[offset+1] / 128 - 1) * MAX_INITIAL_V)\n\n  isTextAt: (x, y) ->\n    offset = y * @width + x\n    return @imageData[offset+2] > 128\n\n\n# Generate a random number between from and to\nrandom = (from, to) ->\n  from + (Math.random() * (to - from))\n\n# Function to get millisecond-accurate epoch timer, more efficient in\n# browsres that support Date.now()\n\nif Date.now\n  getTimer = Date.now\nelse\n  getTimer = ->\n    new Date().getTime()\n\n# Create a random fully saturated color. Colors are fully\n# saturated if they have one RGB value at 255, one at 0, and\n# the third at some  arbitrary value.\nrandomColor = ->\n  parts = [\n    255\n    Math.floor(random(0, 255))\n    0\n  ]\n  parts[1] = \"0\" + parts[1]  if parts[1].length is 1\n  from = 0\n\n  while from < parts.length\n    to = Math.floor(random(0, parts.length))\n    tmp = parts[from]\n    parts[from] = parts[to]\n    parts[to] = tmp\n    from++\n  \"rgba(\" + parts[0] + \",\" + parts[1] + \",\" + parts[2] + \",\" + TRANSPARENCY + \")\"\n\n# Create a random fully desaturated color, i.e. one in which\n# R, G and B values are all the same\nrandomGrey = ->\n  shade = Math.floor(GREY_VALUE.get())\n  \"rgba(\" + shade + \",\" + shade + \",\" + shade + \",\" + TRANSPARENCY + \")\"\n\n\n\nclass Point\n  constructor: (@x, @y) ->\n\n  clone: -> new Point(@x, @y)\n","# http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n# http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n# requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel\n\n# MIT license\n(->\n  lastTime = 0\n  vendors = [\n    \"ms\"\n    \"moz\"\n    \"webkit\"\n    \"o\"\n  ]\n  x = 0\n\n  while x < vendors.length and not window.requestAnimationFrame\n    window.requestAnimationFrame = window[vendors[x] + \"RequestAnimationFrame\"]\n    window.cancelAnimationFrame = window[vendors[x] + \"CancelAnimationFrame\"] or window[vendors[x] + \"CancelRequestAnimationFrame\"]\n    ++x\n  unless window.requestAnimationFrame\n    window.requestAnimationFrame = (callback, element) ->\n      currTime = new Date().getTime()\n      timeToCall = Math.max(0, 16 - (currTime - lastTime))\n      id = window.setTimeout(->\n        callback currTime + timeToCall\n        return\n      , timeToCall)\n      lastTime = currTime + timeToCall\n      id\n  unless window.cancelAnimationFrame\n    window.cancelAnimationFrame = (id) ->\n      clearTimeout id\n      return\n  return\n)()\n"]}