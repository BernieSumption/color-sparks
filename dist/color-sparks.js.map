{"version":3,"sources":["app/console-polyfill.js","app/color-sparks.coffee","app/requestAnimationFrame.coffee"],"names":["con","prop","method","empty","dummy","properties","split","methods","pop","this","console","BACKGROUND_COLOR","BG_RELEASE_PROBABILITY","ColorSparks","DARKENING_ALPHA","DARKENING_DIAMETER","FORCE_AMPLITUDE","FORCE_PERIOD","GREY_VALUE","INITIAL_DIAMETER","INITIAL_SPARKS_PER_SECOND","MAX_INITIAL_V","MAX_SPARKS_PER_SECOND","MIN_SPARKS_PER_SECOND","Point","RADIUS_DECAY","Range","SPARKS_PER_SECOND_ADJUST_RATE","SPARK_RELEASE_POWER","SPARK_RELEASE_RADIUS","Spark","TARGET_FPS","TRANSPARENCY","VelocityMap","getTimer","random","randomColor","randomGrey","__bind","fn","me","apply","arguments","from","to","prototype","get","canvas","velocityMapUrl","logPerformance","updateSparkPosition","draw","ctx","getContext","velocityMap","frameCount","framesPerSecond","sparksPerSecond","addEventListener","reset","window","requestAnimationFrame","height","offsetHeight","width","offsetWidth","beginPath","rect","closePath","fillStyle","fill","releaseX","releaseY","sparks","timestamp","finishedUpTo","i","sparksToRelease","_i","loaded","Math","round","prevTimestamp","log","length","toFixed","releaseSpark","timestampLastFrame","active","update","splice","event","offsetX","layerX","offsetY","layerY","preventDefault","centerX","centerY","angle","isForeground","offset","spark","velocity","x","y","_ref","pow","PI","sin","cos","dataAt","max","push","location","canvasWidth","initialLocation","clone","forceCounter","radius","radiusDecay","xForceAmplitude","xForcePeriod","yForceAmplitude","yForcePeriod","color","darkeningRadius","arc","src","handleImageError","handleImageLoad","image","Image","onload","onerror","imgCanvas","imgCtx","document","createElement","imgWidth","imgHeight","drawImage","imageData","getImageData","data","error","canvasHeight","sampleX","sampleY","scale","yOffset","floor","Date","now","getTime","parts","tmp","shade","lastTime","vendors","cancelAnimationFrame","callback","element","currTime","id","timeToCall","setTimeout","clearTimeout"],"mappings":"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","file":"dist/color-sparks.js","sourcesContent":["// Console-polyfill. MIT license.\n// https://github.com/paulmillr/console-polyfill\n// Make it safe to do console.log() always.\n(function(con) {\n  'use strict';\n  var prop, method;\n  var empty = {};\n  var dummy = function() {};\n  var properties = 'memory'.split(',');\n  var methods = ('assert,clear,count,debug,dir,dirxml,error,exception,group,' +\n  'groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,' +\n  'show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn').split(',');\n  while (prop = properties.pop()) con[prop] = con[prop] || empty;\n  while (method = methods.pop()) con[method] = con[method] || dummy;\n})(this.console = this.console || {}); // Using `this` for web workers.\n","\n\n\n# Represents a property that can take any value in a range\nclass Range\n  constructor: (@from, @to) ->\n  get: ->\n    random @from, @to\n\n# Configuration constants.\n# All measurements are relative to canvas width\n\nRADIUS_DECAY = new Range(0.95, 0.99)\nMAX_INITIAL_V = 1\nINITIAL_DIAMETER = new Range(.005, .015)\nFORCE_AMPLITUDE = new Range(-0.2, 0.2)\nFORCE_PERIOD = new Range(10, 50)\nGREY_VALUE = new Range(0, 128)\nTRANSPARENCY = 0.1\nBG_RELEASE_PROBABILITY = 0.3\nBACKGROUND_COLOR = \"#000000\"\nSPARK_RELEASE_RADIUS = 0.2\nSPARK_RELEASE_POWER = 2\nDARKENING_DIAMETER = new Range(0.002, 0.01)\nDARKENING_ALPHA = 0.1\n\n\nINITIAL_SPARKS_PER_SECOND = 500\nMAX_SPARKS_PER_SECOND = 1500\nMIN_SPARKS_PER_SECOND = 100\nTARGET_FPS = 30\nSPARKS_PER_SECOND_ADJUST_RATE = 0.05\n\n\n# A canvas onto which dots are drawn\nclass ColorSparks\n  constructor: (@canvas, velocityMapUrl, @logPerformance = false) ->\n    @ctx = canvas.getContext \"2d\"\n    @velocityMap = new VelocityMap(velocityMapUrl)\n\n    @frameCount = 0\n    @framesPerSecond = 60\n    @sparksPerSecond = INITIAL_SPARKS_PER_SECOND\n\n    @canvas.addEventListener \"mousedown\", @updateSparkPosition\n    @canvas.addEventListener \"mousemove\", @updateSparkPosition\n    @canvas.addEventListener \"touchstart\", @updateSparkPosition\n    @canvas.addEventListener \"touchmove\", @updateSparkPosition\n\n    @reset()\n\n    window.requestAnimationFrame @draw\n\n  # wipe the canvas and reset the animation state\n  reset: ->\n    @canvas.height = @height = @canvas.offsetHeight\n    @canvas.width = @width = @canvas.offsetWidth\n    @ctx.beginPath()\n    @ctx.rect 0, 0, @canvas.width, @canvas.height\n    @ctx.closePath()\n    @ctx.fillStyle = BACKGROUND_COLOR\n    @ctx.fill()\n    @releaseX = @width/2\n    @releaseY = @height/2\n    @sparks = []\n    return\n\n  # main rendering function executed every frame\n  draw: (timestamp) =>\n    unless @height == @canvas.offsetHeight and @width == @canvas.offsetWidth\n      @reset()\n\n    if @velocityMap.loaded\n\n      # calculate frames per second, averaging over 10 frames for consistency\n      @frameCount += 1\n      if @frameCount % 10 == 1\n        @framesPerSecond = Math.round(10 / (timestamp - @prevTimestamp) * 1000) || 60 # assume 60 fps on first frame\n        @prevTimestamp = timestamp\n\n      # adjust spark release rate up or down to hit target fps\n      if @framesPerSecond < TARGET_FPS and @sparksPerSecond > MIN_SPARKS_PER_SECOND\n        @sparksPerSecond -= (@sparksPerSecond * SPARKS_PER_SECOND_ADJUST_RATE)\n      else if @framesPerSecond > TARGET_FPS and @sparksPerSecond < MAX_SPARKS_PER_SECOND\n        @sparksPerSecond += (@sparksPerSecond * SPARKS_PER_SECOND_ADJUST_RATE)\n\n      if @logPerformance and @frameCount % 10 == 0\n        console.log \"fps=#{@framesPerSecond}, sparks=#{@sparks.length}, releaseRate=#{@sparksPerSecond.toFixed(2)}\"\n\n      sparksToRelease = @sparksPerSecond / @framesPerSecond\n      for i in [0..sparksToRelease] by 1\n        @releaseSpark(@releaseX, @releaseY)\n      @timestampLastFrame = timestamp\n\n      i = 0\n      finishedUpTo = -1\n      while i < @sparks.length\n        if @sparks[i].active\n          @sparks[i].update(@ctx)\n        else if finishedUpTo == i - 1\n            finishedUpTo = i\n        i++\n      if finishedUpTo > -1\n        @sparks.splice 0, finishedUpTo + 1\n\n    window.requestAnimationFrame @draw\n    return\n\n\n  updateSparkPosition: (event) =>\n    @releaseX = event.offsetX || event.layerX\n    @releaseY = event.offsetY || event.layerY\n    event.preventDefault()\n\n\n  releaseSpark: (centerX, centerY) ->\n    offset = Math.pow(Math.random(), SPARK_RELEASE_POWER) * SPARK_RELEASE_RADIUS * @width\n    angle = Math.random() * Math.PI * 2\n    x = centerX + Math.sin(angle) * offset\n    y = centerY + Math.cos(angle) * offset\n\n    [velocity, isForeground] = @velocityMap.dataAt(x, y, @width, @height)\n    if (!isForeground) and Math.random() > BG_RELEASE_PROBABILITY\n      return\n    spark = new Spark(\n      new Point(x, y),\n      velocity,\n      isForeground,\n      Math.max(@width, @height))\n    @sparks.push(spark)\n\n\n\n# A single dot on a ColorSparks canvas\nclass Spark\n\n  # Create a point with location and velocity Points\n  # and a color style\n  constructor: (@location, @velocity, isForeground, canvasWidth) ->\n    @initialLocation = @location.clone()\n    @forceCounter = 0\n    @active = true\n\n    @radius = INITIAL_DIAMETER.get() / 2 * canvasWidth\n    @radiusDecay = RADIUS_DECAY.get()\n    @xForceAmplitude = FORCE_AMPLITUDE.get()\n    @xForcePeriod = FORCE_PERIOD.get()\n    @yForceAmplitude = FORCE_AMPLITUDE.get()\n    @yForcePeriod = FORCE_PERIOD.get()\n\n    if isForeground\n      @color = randomColor()\n      @darkeningRadius = DARKENING_DIAMETER.get() / 2 * canvasWidth\n    else\n      @color = randomGrey()\n      @darkeningRadius = false\n\n\n  update: (ctx) =>\n    ctx.beginPath()\n    ctx.arc @location.x, @location.y, @radius, 0, Math.PI * 2, false\n    ctx.closePath()\n    ctx.fillStyle = @color\n    ctx.fill()\n    @forceCounter++\n    @velocity.x += Math.sin(Math.PI * 2 * @forceCounter / @xForcePeriod) * @xForceAmplitude\n    @velocity.y += Math.sin(Math.PI * 2 * @forceCounter / @yForcePeriod) * @yForceAmplitude\n    if @darkeningRadius\n      ctx.beginPath()\n      ctx.arc @initialLocation.x + random(-1, 1), @initialLocation.y + random(-1, 1), @darkeningRadius, 0, Math.PI * 2, false\n      ctx.closePath()\n      ctx.fillStyle = \"rgba(0, 0, 0, \" + DARKENING_ALPHA + \")\"\n      ctx.fill()\n    if @radius < 1\n      @active = false\n    @location.x += @velocity.x\n    @location.y += @velocity.y\n    @radius *= @radiusDecay\n    return\n\n\n# A class that uses a source image to control direction of movement\n# the red and green channels of the image are x and y velocity, the\n# blue channel defines whether a pixel is considered \"foreground\"\nclass VelocityMap\n  constructor: (@src) ->\n    @loaded = false\n    @image = new Image()\n    @image.onload = @handleImageLoad\n    @image.onerror = @handleImageError\n    @image.src = @src\n\n  handleImageLoad: =>\n    imgCanvas = document.createElement(\"canvas\")\n    imgCanvas.width = @imgWidth = @image.width\n    imgCanvas.height = @imgHeight = @image.height\n    imgCtx = imgCanvas.getContext(\"2d\")\n    imgCtx.drawImage @image, 0, 0\n    @imageData = imgCtx.getImageData(0, 0, imgCanvas.width, imgCanvas.height).data\n    @loaded = true\n\n  handleImageError: (event) =>\n    console.error(\"Image #{@src} failed to load\", event)\n\n  # return the data at a specific position as a 2-array of [velocity, isForeground]\n  dataAt: (x, y, canvasWidth, canvasHeight) ->\n\n    scale = @imgWidth / canvasWidth\n    yOffset = ((canvasHeight * scale) - @imgHeight) / 2\n\n    sampleX = Math.floor(x * scale)\n    sampleY = Math.floor(y * scale - yOffset)\n\n    offset = (sampleY * @imgWidth + sampleX) * 4\n\n    if sampleX < 0 or sampleX > @imgWidth or sampleY < 0 or sampleY > @imgHeight\n      return [new Point(0, 0), false]\n\n    velocity = new Point(\n      (@imageData[offset] / 128 - 1) * MAX_INITIAL_V\n      (@imageData[offset+1] / 128 - 1) * MAX_INITIAL_V)\n    isForeground = @imageData[offset+2] > 128\n    return [velocity, isForeground]\n\n\n\n# Generate a random number between from and to\nrandom = (from, to) ->\n  from + (Math.random() * (to - from))\n\n# Function to get millisecond-accurate epoch timer, more efficient in\n# browsres that support Date.now()\n\nif Date.now\n  getTimer = Date.now\nelse\n  getTimer = ->\n    new Date().getTime()\n\n# Create a random fully saturated color. Colors are fully\n# saturated if they have one RGB value at 255, one at 0, and\n# the third at some  arbitrary value.\nrandomColor = ->\n  parts = [\n    255\n    Math.floor(random(0, 255))\n    0\n  ]\n  parts[1] = \"0\" + parts[1]  if parts[1].length is 1\n  from = 0\n\n  while from < parts.length\n    to = Math.floor(random(0, parts.length))\n    tmp = parts[from]\n    parts[from] = parts[to]\n    parts[to] = tmp\n    from++\n  \"rgba(\" + parts[0] + \",\" + parts[1] + \",\" + parts[2] + \",\" + TRANSPARENCY + \")\"\n\n# Create a random fully desaturated color, i.e. one in which\n# R, G and B values are all the same\nrandomGrey = ->\n  shade = Math.floor(GREY_VALUE.get())\n  \"rgba(\" + shade + \",\" + shade + \",\" + shade + \",\" + TRANSPARENCY + \")\"\n\n\n\nclass Point\n  constructor: (@x, @y) ->\n\n  clone: -> new Point(@x, @y)\n","# http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n# http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n# requestAnimationFrame polyfill by Erik Möller. fixes from Paul Irish and Tino Zijdel\n\n# MIT license\n(->\n  lastTime = 0\n  vendors = [\n    \"ms\"\n    \"moz\"\n    \"webkit\"\n    \"o\"\n  ]\n  x = 0\n\n  while x < vendors.length and not window.requestAnimationFrame\n    window.requestAnimationFrame = window[vendors[x] + \"RequestAnimationFrame\"]\n    window.cancelAnimationFrame = window[vendors[x] + \"CancelAnimationFrame\"] or window[vendors[x] + \"CancelRequestAnimationFrame\"]\n    ++x\n  unless window.requestAnimationFrame\n    window.requestAnimationFrame = (callback, element) ->\n      currTime = new Date().getTime()\n      timeToCall = Math.max(0, 16 - (currTime - lastTime))\n      id = window.setTimeout(->\n        callback currTime + timeToCall\n        return\n      , timeToCall)\n      lastTime = currTime + timeToCall\n      id\n  unless window.cancelAnimationFrame\n    window.cancelAnimationFrame = (id) ->\n      clearTimeout id\n      return\n  return\n)()\n"]}