!function(t){"use strict";for(var i,e,a={},s=function(){},n="memory".split(","),o="assert,clear,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profiles,profileEnd,show,table,time,timeEnd,timeline,timelineEnd,timeStamp,trace,warn".split(",");i=n.pop();)t[i]=t[i]||a;for(;e=o.pop();)t[e]=t[e]||s}(this.console=this.console||{});var BACKGROUND_COLOR,BG_RELEASE_PROBABILITY,ColorSparks,DARKENING_ALPHA,DARKENING_DIAMETER,FORCE_AMPLITUDE,FORCE_PERIOD,GREY_VALUE,INITIAL_DIAMETER,INITIAL_SPARKS_PER_SECOND,MAX_INITIAL_V,MAX_SPARKS_PER_SECOND,MIN_SPARKS_PER_SECOND,Point,RADIUS_DECAY,Range,SPARKS_PER_SECOND_ADJUST_RATE,SPARK_RELEASE_POWER,SPARK_RELEASE_RADIUS,Spark,TARGET_FPS,TRANSPARENCY,VelocityMap,getTimer,random,randomColor,randomGrey,__bind=function(t,i){return function(){return t.apply(i,arguments)}};Range=function(){function t(t,i){this.from=t,this.to=i}return t.prototype.get=function(){return random(this.from,this.to)},t}(),RADIUS_DECAY=new Range(.95,.99),MAX_INITIAL_V=1,INITIAL_DIAMETER=new Range(.005,.015),FORCE_AMPLITUDE=new Range(-.2,.2),FORCE_PERIOD=new Range(10,50),GREY_VALUE=new Range(0,128),TRANSPARENCY=.1,BG_RELEASE_PROBABILITY=.3,BACKGROUND_COLOR="#000000",SPARK_RELEASE_RADIUS=.1,SPARK_RELEASE_POWER=2,DARKENING_DIAMETER=new Range(.002,.01),DARKENING_ALPHA=.1,INITIAL_SPARKS_PER_SECOND=500,MAX_SPARKS_PER_SECOND=1500,MIN_SPARKS_PER_SECOND=100,TARGET_FPS=30,SPARKS_PER_SECOND_ADJUST_RATE=.05,ColorSparks=function(){function t(t,i,e){this.canvas=t,this.logPerformance=null!=e?e:!1,this.updateSparkPosition=__bind(this.updateSparkPosition,this),this.draw=__bind(this.draw,this),this.ctx=t.getContext("2d"),this.velocityMap=new VelocityMap(i),this.frameCount=0,this.framesPerSecond=60,this.sparksPerSecond=INITIAL_SPARKS_PER_SECOND,this.canvas.addEventListener("mousedown",this.updateSparkPosition),this.canvas.addEventListener("mousemove",this.updateSparkPosition),this.canvas.addEventListener("touchstart",this.updateSparkPosition),this.canvas.addEventListener("touchmove",this.updateSparkPosition),this.reset(),window.requestAnimationFrame(this.draw)}return t.prototype.reset=function(){this.canvas.height=this.height=this.canvas.offsetHeight,this.canvas.width=this.width=this.canvas.offsetWidth,this.ctx.beginPath(),this.ctx.rect(0,0,this.canvas.width,this.canvas.height),this.ctx.closePath(),this.ctx.fillStyle=BACKGROUND_COLOR,this.ctx.fill(),this.releaseX=this.width/2,this.releaseY=this.height/2,this.sparks=[]},t.prototype.draw=function(t){var i,e,a,s;if((this.height!==this.canvas.offsetHeight||this.width!==this.canvas.offsetWidth)&&this.reset(),this.velocityMap.loaded){for(this.frameCount+=1,this.frameCount%10===1&&(this.framesPerSecond=Math.round(10/(t-this.prevTimestamp)*1e3)||60,this.prevTimestamp=t),this.framesPerSecond<TARGET_FPS&&this.sparksPerSecond>MIN_SPARKS_PER_SECOND?this.sparksPerSecond-=this.sparksPerSecond*SPARKS_PER_SECOND_ADJUST_RATE:this.framesPerSecond>TARGET_FPS&&this.sparksPerSecond<MAX_SPARKS_PER_SECOND&&(this.sparksPerSecond+=this.sparksPerSecond*SPARKS_PER_SECOND_ADJUST_RATE),this.logPerformance&&this.frameCount%10===0&&console.log("fps="+this.framesPerSecond+", sparks="+this.sparks.length+", releaseRate="+this.sparksPerSecond.toFixed(2)),a=this.sparksPerSecond/this.framesPerSecond,e=s=0;a>=s;e=s+=1)this.releaseSpark(this.releaseX,this.releaseY);for(this.timestampLastFrame=t,e=0,i=-1;e<this.sparks.length;)this.sparks[e].active?this.sparks[e].update(this.ctx):i===e-1&&(i=e),e++;i>-1&&this.sparks.splice(0,i+1)}window.requestAnimationFrame(this.draw)},t.prototype.updateSparkPosition=function(t){return this.releaseX=t.offsetX||t.layerX,this.releaseY=t.offsetY||t.layerY,t.preventDefault()},t.prototype.releaseSpark=function(t,i){var e,a,s,n,o,r,h,d;return s=Math.pow(Math.random(),SPARK_RELEASE_POWER)*SPARK_RELEASE_RADIUS*this.width,e=Math.random()*Math.PI*2,r=t+Math.sin(e)*s,h=i+Math.cos(e)*s,d=this.velocityMap.dataAt(r,h,this.width,this.height),o=d[0],a=d[1],!a&&Math.random()>BG_RELEASE_PROBABILITY?void 0:(n=new Spark(new Point(r,h),o,a,Math.max(this.width,this.height)),this.sparks.push(n))},t}(),Spark=function(){function t(t,i,e,a){this.location=t,this.velocity=i,this.update=__bind(this.update,this),this.initialLocation=this.location.clone(),this.forceCounter=0,this.active=!0,this.radius=INITIAL_DIAMETER.get()/2*a,this.radiusDecay=RADIUS_DECAY.get(),this.xForceAmplitude=FORCE_AMPLITUDE.get(),this.xForcePeriod=FORCE_PERIOD.get(),this.yForceAmplitude=FORCE_AMPLITUDE.get(),this.yForcePeriod=FORCE_PERIOD.get(),e?(this.color=randomColor(),this.darkeningRadius=DARKENING_DIAMETER.get()/2*a):(this.color=randomGrey(),this.darkeningRadius=!1)}return t.prototype.update=function(t){t.beginPath(),t.arc(this.location.x,this.location.y,this.radius,0,2*Math.PI,!1),t.closePath(),t.fillStyle=this.color,t.fill(),this.forceCounter++,this.velocity.x+=Math.sin(2*Math.PI*this.forceCounter/this.xForcePeriod)*this.xForceAmplitude,this.velocity.y+=Math.sin(2*Math.PI*this.forceCounter/this.yForcePeriod)*this.yForceAmplitude,this.darkeningRadius&&(t.beginPath(),t.arc(this.initialLocation.x+random(-1,1),this.initialLocation.y+random(-1,1),this.darkeningRadius,0,2*Math.PI,!1),t.closePath(),t.fillStyle="rgba(0, 0, 0, "+DARKENING_ALPHA+")",t.fill()),this.radius<1&&(this.active=!1),this.location.x+=this.velocity.x,this.location.y+=this.velocity.y,this.radius*=this.radiusDecay},t}(),VelocityMap=function(){function t(t){this.src=t,this.handleImageError=__bind(this.handleImageError,this),this.handleImageLoad=__bind(this.handleImageLoad,this),this.loaded=!1,this.image=new Image,this.image.onload=this.handleImageLoad,this.image.onerror=this.handleImageError,this.image.src=this.src}return t.prototype.handleImageLoad=function(){var t,i;return t=document.createElement("canvas"),t.width=this.imgWidth=this.image.width,t.height=this.imgHeight=this.image.height,i=t.getContext("2d"),i.drawImage(this.image,0,0),this.imageData=i.getImageData(0,0,t.width,t.height).data,this.loaded=!0},t.prototype.handleImageError=function(t){return console.error("Image "+this.src+" failed to load",t)},t.prototype.dataAt=function(t,i,e,a){var s,n,o,r,h,d,c;return h=this.imgWidth/e,c=(a*h-this.imgHeight)/2,o=Math.floor(t*h),r=Math.floor(i*h-c),n=4*(r*this.imgWidth+o),0>o||o>this.imgWidth||0>r||r>this.imgHeight?[new Point(0,0),!1]:(d=new Point((this.imageData[n]/128-1)*MAX_INITIAL_V,(this.imageData[n+1]/128-1)*MAX_INITIAL_V),s=this.imageData[n+2]>128,[d,s])},t}(),random=function(t,i){return t+Math.random()*(i-t)},getTimer=Date.now?Date.now:function(){return(new Date).getTime()},randomColor=function(){var t,i,e,a;for(i=[255,Math.floor(random(0,255)),0],1===i[1].length&&(i[1]="0"+i[1]),t=0;t<i.length;)a=Math.floor(random(0,i.length)),e=i[t],i[t]=i[a],i[a]=e,t++;return"rgba("+i[0]+","+i[1]+","+i[2]+","+TRANSPARENCY+")"},randomGrey=function(){var t;return t=Math.floor(GREY_VALUE.get()),"rgba("+t+","+t+","+t+","+TRANSPARENCY+")"},Point=function(){function t(t,i){this.x=t,this.y=i}return t.prototype.clone=function(){return new t(this.x,this.y)},t}(),function(){var t,i,e;for(t=0,i=["ms","moz","webkit","o"],e=0;e<i.length&&!window.requestAnimationFrame;)window.requestAnimationFrame=window[i[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[i[e]+"CancelAnimationFrame"]||window[i[e]+"CancelRequestAnimationFrame"],++e;window.requestAnimationFrame||(window.requestAnimationFrame=function(i){var e,a,s;return e=(new Date).getTime(),s=Math.max(0,16-(e-t)),a=window.setTimeout(function(){i(e+s)},s),t=e+s,a}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();
//# sourceMappingURL=dist/color-sparks.js.map
//# sourceMappingURL=color-sparks.js.map